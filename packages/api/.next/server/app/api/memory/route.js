"use strict";(()=>{var e={};e.id=760,e.ids=[760],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},1814:(e,r,t)=>{t.r(r),t.d(r,{originalPathname:()=>y,patchFetch:()=>h,requestAsyncStorage:()=>l,routeModule:()=>p,serverHooks:()=>_,staticGenerationAsyncStorage:()=>f});var s={};t.r(s),t.d(s,{DELETE:()=>d,GET:()=>m,POST:()=>c});var o=t(3036),a=t(5736),n=t(5262),i=t(942),u=t(5655);async function m(e){let{searchParams:r}=new URL(e.url),t=r.get("phone");if(!t)return i.NextResponse.json({error:"Phone number required"},{status:400});if(!u.O)return i.NextResponse.json({error:"Database not configured"},{status:500});try{let{data:e,error:r}=await u.O.from("user_memories").select("*").eq("phone_number",t).eq("is_active",!0).order("importance_score",{ascending:!1}).order("created_at",{ascending:!1});if(r)throw r;let{data:s,error:o}=await u.O.from("memory_clusters").select("*").eq("phone_number",t).order("cluster_score",{ascending:!1});if(o)throw o;let{data:a,error:n}=await u.O.from("conversation_patterns").select("*").eq("phone_number",t).order("confidence_level",{ascending:!1});if(n)throw n;let{data:m,error:c}=await u.O.from("memory_verifications").select(`
        *,
        user_memories (memory_content, memory_summary)
      `).eq("phone_number",t).eq("status","pending").order("created_at",{ascending:!1});if(c)throw c;let{data:d,error:p}=await u.O.from("user_memory_preferences").select("*").eq("phone_number",t).single(),l=e?.reduce((e,r)=>(e[r.memory_type]||(e[r.memory_type]=[]),e[r.memory_type].push(r),e),{});return i.NextResponse.json({success:!0,data:{memories:l||{},clusters:s||[],patterns:a||[],verifications:m||[],preferences:d||{memory_enabled:!0,auto_extract:!0,verification_frequency:"important_only"},stats:{total_memories:e?.length||0,by_importance:{critical:e?.filter(e=>e.importance_score>=8).length||0,important:e?.filter(e=>e.importance_score>=6&&e.importance_score<8).length||0,moderate:e?.filter(e=>e.importance_score>=4&&e.importance_score<6).length||0},by_verification:{verified:e?.filter(e=>"verified"===e.verification_status).length||0,unverified:e?.filter(e=>"unverified"===e.verification_status).length||0,disputed:e?.filter(e=>"disputed"===e.verification_status).length||0}}}})}catch(e){return console.error("Memory dashboard error:",e),i.NextResponse.json({error:"Failed to fetch memory dashboard"},{status:500})}}async function c(e){if(!u.O)return i.NextResponse.json({error:"Database not configured"},{status:500});try{let{action:r,phone_number:t,...s}=await e.json();if(!t)return i.NextResponse.json({error:"Phone number required"},{status:400});switch(r){case"update_preferences":let{data:o,error:a}=await u.O.from("user_memory_preferences").upsert({phone_number:t,...s.preferences,updated_at:new Date().toISOString()},{onConflict:"phone_number"}).select();if(a)throw a;return i.NextResponse.json({success:!0,message:"Preferences updated successfully",data:o});case"verify_memory":let{memory_id:n,verification_response:m,approved:c}=s;return await u.O.from("memory_verifications").update({status:c?"confirmed":"rejected",user_response:m,verified_at:new Date().toISOString()}).eq("memory_id",n).eq("phone_number",t),await u.O.from("user_memories").update({verification_status:c?"verified":"outdated"===m?"outdated":"disputed",is_active:c}).eq("id",n).eq("phone_number",t),i.NextResponse.json({success:!0,message:`Memory ${c?"verified":"disputed"} successfully`});case"delete_memory":let{memory_id:d}=s;return await u.O.from("user_memories").update({is_active:!1,verification_status:"outdated"}).eq("id",d).eq("phone_number",t),i.NextResponse.json({success:!0,message:"Memory deleted successfully"});case"edit_memory":let{memory_id:p,new_content:l,new_summary:f}=s;return await u.O.from("user_memories").update({memory_content:l,memory_summary:f,extraction_method:"corrected",updated_at:new Date().toISOString()}).eq("id",p).eq("phone_number",t),i.NextResponse.json({success:!0,message:"Memory updated successfully"});default:return i.NextResponse.json({error:"Invalid action"},{status:400})}}catch(e){return console.error("Memory update error:",e),i.NextResponse.json({error:"Failed to update memory"},{status:500})}}async function d(e){let{searchParams:r}=new URL(e.url),t=r.get("phone");if(!t)return i.NextResponse.json({error:"Phone number required"},{status:400});if(!u.O)return i.NextResponse.json({error:"Database not configured"},{status:500});try{return await u.O.from("user_memories").update({is_active:!1,verification_status:"outdated"}).eq("phone_number",t),i.NextResponse.json({success:!0,message:"All memories cleared successfully"})}catch(e){return console.error("Memory clear error:",e),i.NextResponse.json({error:"Failed to clear memories"},{status:500})}}let p=new o.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/memory/route",pathname:"/api/memory",filename:"route",bundlePath:"app/api/memory/route"},resolvedPagePath:"/Users/nandinitalwar/trypinch/packages/api/app/api/memory/route.ts",nextConfigOutput:"standalone",userland:s}),{requestAsyncStorage:l,staticGenerationAsyncStorage:f,serverHooks:_}=p,y="/api/memory/route";function h(){return(0,n.patchFetch)({serverHooks:_,staticGenerationAsyncStorage:f})}},5655:(e,r,t)=>{t.d(r,{O:()=>n});var s=t(851);let o="https://aiaonjvzzysswphmedxo.supabase.co",a=process.env.SUPABASE_SERVICE_ROLE_KEY||"";o&&a||console.error("WARNING: Missing Supabase environment variables");let n=o&&a?(0,s.eI)(o,a,{auth:{autoRefreshToken:!1,persistSession:!1}}):null}};var r=require("../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[193,435],()=>t(1814));module.exports=s})();